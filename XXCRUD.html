<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bootstrap demo</title>
        <!-- datatable -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
        <!-- bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        
      </head>
  <body>
    <div class="container">
        <div class="col-md-6 max-auto" ></div>
          <form action="#" id="myForm" onsubmit="submitForm(this)">
              <div class="row">
                <!-- id -->
                <input type="text" class="form-control" id="numid" name="numid" hidden>
                  <div class="col-md-6 mb-2">
                      <label for="">name</label>
                      <input type="text" class="form-control" id="fname" name="fname" required placeholder="">
                  </div>
                  <div class="col-md-6 mb-2">
                      <label for=""></label>
                      <select class="form-control" id="classroom" name="classroom" required >
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                      </select>
                  </div>
                  <div class="col-md-6 mb-2">
                      <label for="">email</label>
                      <input type="email" class="form-control" id="email" name="email" required placeholder="">
                  </div>
              </div>
              
              <button class="btn btn-primary" type="submit">
                  submit
              </button>

          </form>
          </div>
          <table id="example" class="display" style="width:100%"></table>
    </div>

    
    
    
    <script>
        // post
        function submitForm(obj){
            event.preventDefault();
            Swal.fire({
              // position: 'top',
              icon: 'info',
              title: 'Loading...',
              showConfirmButton: false
              // timer: 1500
            })
            // Swal.showLoading()
            google.script.run.withSuccessHandler(data=>{
                // console.log('success');
                google.script.run.withSuccessHandler(showData).getData()
                document.getElementById("myForm").reset()
                Swal.fire({
                  // position: 'top',
                  icon: 'success',
                  title: '上傳成功',
                  showConfirmButton: false,
                  timer: 1500
                })
            }).saveData(obj)
        }
        // datatable
        google.script.run.withSuccessHandler(showData).getData()

        function showData(dataArray){
            $("#example").DataTable({
            // new DataTable('#example', {
                data: dataArray.slice(1),
                columns: [
                    { title: 'ID' },
                    { title: 'fname' },
                    { title: 'classroom' },
                    { title: 'email' },
                    { title: '編輯.' },
                    { title: '刪除' },
                ],
                columnDefs: [
                    {
                        data: null,
                        defaultContent: '<button class="btn btn-warning btn-sm" onclick="editData(this)">編輯</button>',
                        targets: 4
                    },
                    {
                        data: null,
                        defaultContent: '<button class="btn btn-danger btn-sm" onclick="delData(this)">刪除</button>',
                        targets: 5
                    }
                ],
                // 初始化和重新初始化。
                destroy:true,
            });
        }
        // 編輯 
        function editData(el){
          var record = el.parentNode.parentNode.cells[0].innerText;
          var fname = el.parentNode.parentNode.cells[1].innerText;
          var classroom = el.parentNode.parentNode.cells[2].innerText;
          var email = el.parentNode.parentNode.cells[3].innerText;
            document.getElementById("numid").value = record
            document.getElementById("fname").value = fname
            document.getElementById("classroom").value = classroom
            document.getElementById("email").value = email
        }
        // 刪除
        function delData(el){
          Swal.fire({
            title: '確定刪除嗎?',
            // text: "!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: '確定刪除',
            cancelButtonText: '取消',
          }).then((result) => {
            if (result.isConfirmed) {
              Swal.fire(
                '訊息公告',
                '您已成功刪除',
                'success'
              )
              var record = el.parentNode.parentNode.cells[0].innerText
              google.script.run.withSuccessHandler(()=>{
              google.script.run.withSuccessHandler(showData).getData()
              }).delData(record)
            }
          })
        }

        // function delData(el){
        //   var record = el.parentNode.parentNode.cells[0].innerText
        //     google.script.run.withSuccessHandler(()=>{
        //     google.script.run.withSuccessHandler(showData).getData()
        //   }).delData(record)
        // }

    </script>
    <!-- sweet alert -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- datatable -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>


<!-- gs -->
<!-- // 程式碼教學 https://www.youtube.com/watch?v=foj9dOIkaJI&t=1160s
// post
function doGet() {
  return HtmlService.createTemplateFromFile("index").evaluate()
  .setTitle("WebAppCRUD")
  .addMetaTag('viewport','width=device-width, initial-scale=1')
  .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
function include(filename){
  return HtmlService.createHtmlOutputFromFile(filename).getContent();
}
// ss 試算表名稱
let ss = SpreadsheetApp.getActive().getSheetByName('Data') 
let data = ss.getDataRange().getDisplayValues()
let id = data.map(r => r[0])

function getData(){
  return data
}

function saveData(obj){
  if(obj.numid == ''){
    ss.appendRow([
      new Date().getTime().toString(),
      obj.fname,
      obj.classroom,
      obj.email
    ])
  }else{
    var index = id.indexOf(obj.numid)
    ss.getRange(index +1,2).setValue(obj.fname)
    ss.getRange(index +1,3).setValue(obj.classroom)
    ss.getRange(index +1,4).setValue(obj.email)

  }
  return true
}
function delData(record){
    var index = id.indexOf(record)
    ss.deleteRow(index+1)
} -->













